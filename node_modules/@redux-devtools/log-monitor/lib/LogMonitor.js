"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var themes = _interopRequireWildcard(require("redux-devtools-themes"));

var _core = require("@redux-devtools/core");

var _lodash = _interopRequireDefault(require("lodash.debounce"));

var _actions = require("./actions");

var _reducers = _interopRequireDefault(require("./reducers"));

var _LogMonitorButtonBar = _interopRequireDefault(require("./LogMonitorButtonBar"));

var _LogMonitorEntryList = _interopRequireDefault(require("./LogMonitorEntryList"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

// eslint-disable-next-line @typescript-eslint/unbound-method
var toggleAction = _core.ActionCreators.toggleAction,
    setActionsActive = _core.ActionCreators.setActionsActive;
var styles = {
  container: {
    fontFamily: 'monaco, Consolas, Lucida Console, monospace',
    position: 'relative',
    overflowY: 'hidden',
    width: '100%',
    height: '100%',
    minWidth: 300,
    direction: 'ltr'
  },
  elements: {
    position: 'absolute',
    left: 0,
    right: 0,
    top: 0,
    bottom: 0,
    overflowX: 'hidden',
    overflowY: 'auto'
  }
};

var LogMonitor = /*#__PURE__*/function (_PureComponent) {
  _inherits(LogMonitor, _PureComponent);

  var _super = _createSuper(LogMonitor);

  function LogMonitor() {
    var _this;

    _classCallCheck(this, LogMonitor);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));

    _defineProperty(_assertThisInitialized(_this), "scrollDown", void 0);

    _defineProperty(_assertThisInitialized(_this), "node", void 0);

    _defineProperty(_assertThisInitialized(_this), "updateScrollTop", (0, _lodash["default"])(function () {
      var node = _this.node;

      _this.props.dispatch((0, _actions.updateScrollTop)(node ? node.scrollTop : 0));
    }, 500));

    _defineProperty(_assertThisInitialized(_this), "handleToggleAction", function (id) {
      _this.props.dispatch(toggleAction(id));
    });

    _defineProperty(_assertThisInitialized(_this), "handleToggleConsecutiveAction", function (id) {
      var _this$props = _this.props,
          monitorState = _this$props.monitorState,
          actionsById = _this$props.actionsById;
      var consecutiveToggleStartId = monitorState.consecutiveToggleStartId;

      if (consecutiveToggleStartId && actionsById[consecutiveToggleStartId]) {
        var skippedActionIds = _this.props.skippedActionIds;
        var start = Math.min(consecutiveToggleStartId, id);
        var end = Math.max(consecutiveToggleStartId, id);
        var active = skippedActionIds.indexOf(consecutiveToggleStartId) > -1;

        _this.props.dispatch(setActionsActive(start, end + 1, active));

        _this.props.dispatch((0, _actions.startConsecutiveToggle)(null));
      } else if (id > 0) {
        _this.props.dispatch((0, _actions.startConsecutiveToggle)(id));
      }
    });

    _defineProperty(_assertThisInitialized(_this), "getRef", function (node) {
      _this.node = node;
    });

    return _this;
  }

  _createClass(LogMonitor, [{
    key: "scroll",
    value: function scroll() {
      var node = this.node;

      if (!node) {
        return;
      }

      if (this.scrollDown) {
        var offsetHeight = node.offsetHeight,
            scrollHeight = node.scrollHeight;
        node.scrollTop = scrollHeight - offsetHeight;
        this.scrollDown = false;
      }
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      var node = this.node;

      if (!node || !this.props.monitorState) {
        return;
      }

      if (this.props.preserveScrollTop) {
        node.scrollTop = this.props.monitorState.initialScrollTop;
        node.addEventListener('scroll', this.updateScrollTop);
      } else {
        this.scrollDown = true;
        this.scroll();
      }
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      var node = this.node;

      if (node && this.props.preserveScrollTop) {
        node.removeEventListener('scroll', this.updateScrollTop);
      }
    }
  }, {
    key: "UNSAFE_componentWillReceiveProps",
    value: function UNSAFE_componentWillReceiveProps(nextProps) {
      var node = this.node;

      if (!node) {
        this.scrollDown = true;
      } else if (this.props.stagedActionIds.length < nextProps.stagedActionIds.length) {
        var scrollTop = node.scrollTop,
            offsetHeight = node.offsetHeight,
            scrollHeight = node.scrollHeight;
        this.scrollDown = Math.abs(scrollHeight - (scrollTop + offsetHeight)) < 20;
      } else {
        this.scrollDown = false;
      }
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      this.scroll();
    }
  }, {
    key: "getTheme",
    value: function getTheme() {
      var theme = this.props.theme;

      if (typeof theme !== 'string') {
        return theme;
      }

      if (typeof themes[theme] !== 'undefined') {
        return themes[theme];
      } // eslint-disable-next-line no-console


      console.warn('DevTools theme ' + theme + ' not found, defaulting to nicinabox');
      return themes.nicinabox;
    }
  }, {
    key: "render",
    value: function render() {
      var theme = this.getTheme();
      var consecutiveToggleStartId = this.props.monitorState.consecutiveToggleStartId;
      var _this$props2 = this.props,
          dispatch = _this$props2.dispatch,
          actionsById = _this$props2.actionsById,
          skippedActionIds = _this$props2.skippedActionIds,
          stagedActionIds = _this$props2.stagedActionIds,
          computedStates = _this$props2.computedStates,
          currentStateIndex = _this$props2.currentStateIndex,
          select = _this$props2.select,
          expandActionRoot = _this$props2.expandActionRoot,
          expandStateRoot = _this$props2.expandStateRoot,
          markStateDiff = _this$props2.markStateDiff;
      var entryListProps = {
        theme: theme,
        actionsById: actionsById,
        skippedActionIds: skippedActionIds,
        stagedActionIds: stagedActionIds,
        computedStates: computedStates,
        currentStateIndex: currentStateIndex,
        consecutiveToggleStartId: consecutiveToggleStartId,
        select: select,
        expandActionRoot: expandActionRoot,
        expandStateRoot: expandStateRoot,
        markStateDiff: markStateDiff,
        onActionClick: this.handleToggleAction,
        onActionShiftClick: this.handleToggleConsecutiveAction
      };
      return /*#__PURE__*/_react["default"].createElement("div", {
        style: _objectSpread(_objectSpread({}, styles.container), {}, {
          backgroundColor: theme.base00
        })
      }, !this.props.hideMainButtons && /*#__PURE__*/_react["default"].createElement(_LogMonitorButtonBar["default"], {
        theme: theme,
        dispatch: dispatch,
        hasStates: computedStates.length > 1,
        hasSkippedActions: skippedActionIds.length > 0
      }), /*#__PURE__*/_react["default"].createElement("div", {
        style: this.props.hideMainButtons ? styles.elements : _objectSpread(_objectSpread({}, styles.elements), {}, {
          top: 30
        }),
        ref: this.getRef
      }, /*#__PURE__*/_react["default"].createElement(_LogMonitorEntryList["default"], entryListProps)));
    }
  }]);

  return LogMonitor;
}(_react.PureComponent);

_defineProperty(LogMonitor, "update", _reducers["default"]);

_defineProperty(LogMonitor, "propTypes", {
  dispatch: _propTypes["default"].func,
  computedStates: _propTypes["default"].array,
  actionsById: _propTypes["default"].object,
  stagedActionIds: _propTypes["default"].array,
  skippedActionIds: _propTypes["default"].array,
  monitorState: _propTypes["default"].shape({
    initialScrollTop: _propTypes["default"].number,
    consecutiveToggleStartId: _propTypes["default"].number
  }),
  preserveScrollTop: _propTypes["default"].bool,
  select: _propTypes["default"].func,
  theme: _propTypes["default"].oneOfType([_propTypes["default"].object, _propTypes["default"].string]),
  expandActionRoot: _propTypes["default"].bool,
  expandStateRoot: _propTypes["default"].bool,
  markStateDiff: _propTypes["default"].bool,
  hideMainButtons: _propTypes["default"].bool
});

_defineProperty(LogMonitor, "defaultProps", {
  select: function select(state) {
    return state;
  },
  theme: 'nicinabox',
  preserveScrollTop: true,
  expandActionRoot: true,
  expandStateRoot: true,
  markStateDiff: false
});

var _default = LogMonitor;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Mb2dNb25pdG9yLnRzeCJdLCJuYW1lcyI6WyJ0b2dnbGVBY3Rpb24iLCJBY3Rpb25DcmVhdG9ycyIsInNldEFjdGlvbnNBY3RpdmUiLCJzdHlsZXMiLCJjb250YWluZXIiLCJmb250RmFtaWx5IiwicG9zaXRpb24iLCJvdmVyZmxvd1kiLCJ3aWR0aCIsImhlaWdodCIsIm1pbldpZHRoIiwiZGlyZWN0aW9uIiwiZWxlbWVudHMiLCJsZWZ0IiwicmlnaHQiLCJ0b3AiLCJib3R0b20iLCJvdmVyZmxvd1giLCJMb2dNb25pdG9yIiwibm9kZSIsInByb3BzIiwiZGlzcGF0Y2giLCJzY3JvbGxUb3AiLCJpZCIsIm1vbml0b3JTdGF0ZSIsImFjdGlvbnNCeUlkIiwiY29uc2VjdXRpdmVUb2dnbGVTdGFydElkIiwic2tpcHBlZEFjdGlvbklkcyIsInN0YXJ0IiwiTWF0aCIsIm1pbiIsImVuZCIsIm1heCIsImFjdGl2ZSIsImluZGV4T2YiLCJzY3JvbGxEb3duIiwib2Zmc2V0SGVpZ2h0Iiwic2Nyb2xsSGVpZ2h0IiwicHJlc2VydmVTY3JvbGxUb3AiLCJpbml0aWFsU2Nyb2xsVG9wIiwiYWRkRXZlbnRMaXN0ZW5lciIsInVwZGF0ZVNjcm9sbFRvcCIsInNjcm9sbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJuZXh0UHJvcHMiLCJzdGFnZWRBY3Rpb25JZHMiLCJsZW5ndGgiLCJhYnMiLCJ0aGVtZSIsInRoZW1lcyIsImNvbnNvbGUiLCJ3YXJuIiwibmljaW5hYm94IiwiZ2V0VGhlbWUiLCJjb21wdXRlZFN0YXRlcyIsImN1cnJlbnRTdGF0ZUluZGV4Iiwic2VsZWN0IiwiZXhwYW5kQWN0aW9uUm9vdCIsImV4cGFuZFN0YXRlUm9vdCIsIm1hcmtTdGF0ZURpZmYiLCJlbnRyeUxpc3RQcm9wcyIsIm9uQWN0aW9uQ2xpY2siLCJoYW5kbGVUb2dnbGVBY3Rpb24iLCJvbkFjdGlvblNoaWZ0Q2xpY2siLCJoYW5kbGVUb2dnbGVDb25zZWN1dGl2ZUFjdGlvbiIsImJhY2tncm91bmRDb2xvciIsImJhc2UwMCIsImhpZGVNYWluQnV0dG9ucyIsImdldFJlZiIsIlB1cmVDb21wb25lbnQiLCJyZWR1Y2VyIiwiUHJvcFR5cGVzIiwiZnVuYyIsImFycmF5Iiwib2JqZWN0Iiwic2hhcGUiLCJudW1iZXIiLCJib29sIiwib25lT2ZUeXBlIiwic3RyaW5nIiwic3RhdGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQTs7QUFFQTs7QUFLQTs7QUFDQTs7QUFLQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUE7SUFDUUEsWSxHQUFtQ0Msb0IsQ0FBbkNELFk7SUFBY0UsZ0IsR0FBcUJELG9CLENBQXJCQyxnQjtBQUV0QixJQUFNQyxNQUdMLEdBQUc7QUFDRkMsRUFBQUEsU0FBUyxFQUFFO0FBQ1RDLElBQUFBLFVBQVUsRUFBRSw2Q0FESDtBQUVUQyxJQUFBQSxRQUFRLEVBQUUsVUFGRDtBQUdUQyxJQUFBQSxTQUFTLEVBQUUsUUFIRjtBQUlUQyxJQUFBQSxLQUFLLEVBQUUsTUFKRTtBQUtUQyxJQUFBQSxNQUFNLEVBQUUsTUFMQztBQU1UQyxJQUFBQSxRQUFRLEVBQUUsR0FORDtBQU9UQyxJQUFBQSxTQUFTLEVBQUU7QUFQRixHQURUO0FBVUZDLEVBQUFBLFFBQVEsRUFBRTtBQUNSTixJQUFBQSxRQUFRLEVBQUUsVUFERjtBQUVSTyxJQUFBQSxJQUFJLEVBQUUsQ0FGRTtBQUdSQyxJQUFBQSxLQUFLLEVBQUUsQ0FIQztBQUlSQyxJQUFBQSxHQUFHLEVBQUUsQ0FKRztBQUtSQyxJQUFBQSxNQUFNLEVBQUUsQ0FMQTtBQU1SQyxJQUFBQSxTQUFTLEVBQUUsUUFOSDtBQU9SVixJQUFBQSxTQUFTLEVBQUU7QUFQSDtBQVZSLENBSEo7O0lBMERNVyxVOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztzRUFxQ2Msd0JBQVMsWUFBTTtBQUMvQixVQUFNQyxJQUFJLEdBQUcsTUFBS0EsSUFBbEI7O0FBQ0EsWUFBS0MsS0FBTCxDQUFX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QUFDUCxzQkFBVUcsTUFBWCxFQUFtQkgsc0JBQVVRLE1BQTdCLENBQXBCLENBYlU7QUFjakJ0QixFQUFBQSxnQkFBZ0IsRUFBRWMsc0JBQVVNLElBZFg7QUFlakJuQixFQUFBQSxlQUFlLEVBQUVhLHNCQUFVTSxJQWZWO0FBZ0JqQmxCLEVBQUFBLGFBQWEsRUFBRVksc0JBQVVNLElBaEJSO0FBaUJqQlYsRUFBQUEsZUFBZSxFQUFFSSxzQkFBVU07QUFqQlYsQzs7Z0JBTGYzRCxVLGtCQXlCeUM7QUFDM0NzQyxFQUFBQSxNQUFNLEVBQUUsZ0JBQUN3QixLQUFEO0FBQUEsV0FBb0JBLEtBQXBCO0FBQUEsR0FEbUM7QUFFM0NoQyxFQUFBQSxLQUFLLEVBQUUsV0FGb0M7QUFHM0NWLEVBQUFBLGlCQUFpQixFQUFFLElBSHdCO0FBSTNDbUIsRUFBQUEsZ0JBQWdCLEVBQUUsSUFKeUI7QUFLM0NDLEVBQUFBLGVBQWUsRUFBRSxJQUwwQjtBQU0zQ0MsRUFBQUEsYUFBYSxFQUFFO0FBTjRCLEM7O2VBeUsvQnpDLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgUHVyZUNvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgeyBBY3Rpb24sIERpc3BhdGNoIH0gZnJvbSAncmVkdXgnO1xuaW1wb3J0ICogYXMgdGhlbWVzIGZyb20gJ3JlZHV4LWRldnRvb2xzLXRoZW1lcyc7XG5pbXBvcnQgeyBCYXNlMTZUaGVtZSB9IGZyb20gJ3JlZHV4LWRldnRvb2xzLXRoZW1lcyc7XG5pbXBvcnQge1xuICBBY3Rpb25DcmVhdG9ycyxcbiAgTGlmdGVkQWN0aW9uLFxuICBMaWZ0ZWRTdGF0ZSxcbn0gZnJvbSAnQHJlZHV4LWRldnRvb2xzL2NvcmUnO1xuaW1wb3J0IGRlYm91bmNlIGZyb20gJ2xvZGFzaC5kZWJvdW5jZSc7XG5pbXBvcnQge1xuICB1cGRhdGVTY3JvbGxUb3AsXG4gIHN0YXJ0Q29uc2VjdXRpdmVUb2dnbGUsXG4gIExvZ01vbml0b3JBY3Rpb24sXG59IGZyb20gJy4vYWN0aW9ucyc7XG5pbXBvcnQgcmVkdWNlciwgeyBMb2dNb25pdG9yU3RhdGUgfSBmcm9tICcuL3JlZHVjZXJzJztcbmltcG9ydCBMb2dNb25pdG9yQnV0dG9uQmFyIGZyb20gJy4vTG9nTW9uaXRvckJ1dHRvbkJhcic7XG5pbXBvcnQgTG9nTW9uaXRvckVudHJ5TGlzdCBmcm9tICcuL0xvZ01vbml0b3JFbnRyeUxpc3QnO1xuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3VuYm91bmQtbWV0aG9kXG5jb25zdCB7IHRvZ2dsZUFjdGlvbiwgc2V0QWN0aW9uc0FjdGl2ZSB9ID0gQWN0aW9uQ3JlYXRvcnM7XG5cbmNvbnN0IHN0eWxlczoge1xuICBjb250YWluZXI6IFJlYWN0LkNTU1Byb3BlcnRpZXM7XG4gIGVsZW1lbnRzOiBSZWFjdC5DU1NQcm9wZXJ0aWVzO1xufSA9IHtcbiAgY29udGFpbmVyOiB7XG4gICAgZm9udEZhbWlseTogJ21vbmFjbywgQ29uc29sYXMsIEx1Y2lkYSBDb25zb2xlLCBtb25vc3BhY2UnLFxuICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxuICAgIG92ZXJmbG93WTogJ2hpZGRlbicsXG4gICAgd2lkdGg6ICcxMDAlJyxcbiAgICBoZWlnaHQ6ICcxMDAlJyxcbiAgICBtaW5XaWR0aDogMzAwLFxuICAgIGRpcmVjdGlvbjogJ2x0cicsXG4gIH0sXG4gIGVsZW1lbnRzOiB7XG4gICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgbGVmdDogMCxcbiAgICByaWdodDogMCxcbiAgICB0b3A6IDAsXG4gICAgYm90dG9tOiAwLFxuICAgIG92ZXJmbG93WDogJ2hpZGRlbicsXG4gICAgb3ZlcmZsb3dZOiAnYXV0bycsXG4gIH0sXG59O1xuXG5pbnRlcmZhY2UgRXh0ZXJuYWxQcm9wczxTLCBBIGV4dGVuZHMgQWN0aW9uPHVua25vd24+PiB7XG4gIGRpc3BhdGNoOiBEaXNwYXRjaDxMb2dNb25pdG9yQWN0aW9uIHwgTGlmdGVkQWN0aW9uPFMsIEEsIExvZ01vbml0b3JTdGF0ZT4+O1xuXG4gIHByZXNlcnZlU2Nyb2xsVG9wOiBib29sZWFuO1xuICBzZWxlY3Q6IChzdGF0ZTogUykgPT4gdW5rbm93bjtcbiAgdGhlbWU6IGtleW9mIHR5cGVvZiB0aGVtZXMgfCBCYXNlMTZUaGVtZTtcbiAgZXhwYW5kQWN0aW9uUm9vdDogYm9vbGVhbjtcbiAgZXhwYW5kU3RhdGVSb290OiBib29sZWFuO1xuICBtYXJrU3RhdGVEaWZmOiBib29sZWFuO1xuICBoaWRlTWFpbkJ1dHRvbnM/OiBib29sZWFuO1xufVxuXG5pbnRlcmZhY2UgRGVmYXVsdFByb3BzPFM+IHtcbiAgc2VsZWN0OiAoc3RhdGU6IHVua25vd24pID0+IHVua25vd247XG4gIHRoZW1lOiBrZXlvZiB0eXBlb2YgdGhlbWVzIHwgQmFzZTE2VGhlbWU7XG4gIHByZXNlcnZlU2Nyb2xsVG9wOiBib29sZWFuO1xuICBleHBhbmRBY3Rpb25Sb290OiBib29sZWFuO1xuICBleHBhbmRTdGF0ZVJvb3Q6IGJvb2xlYW47XG4gIG1hcmtTdGF0ZURpZmY6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTG9nTW9uaXRvclByb3BzPFMsIEEgZXh0ZW5kcyBBY3Rpb248dW5rbm93bj4+XG4gIGV4dGVuZHMgTGlmdGVkU3RhdGU8UywgQSwgTG9nTW9uaXRvclN0YXRlPiB7XG4gIGRpc3BhdGNoOiBEaXNwYXRjaDxMb2dNb25pdG9yQWN0aW9uIHwgTGlmdGVkQWN0aW9uPFMsIEEsIExvZ01vbml0b3JTdGF0ZT4+O1xuXG4gIHByZXNlcnZlU2Nyb2xsVG9wOiBib29sZWFuO1xuICBzZWxlY3Q6IChzdGF0ZTogUykgPT4gdW5rbm93bjtcbiAgdGhlbWU6IGtleW9mIHR5cGVvZiB0aGVtZXMgfCBCYXNlMTZUaGVtZTtcbiAgZXhwYW5kQWN0aW9uUm9vdDogYm9vbGVhbjtcbiAgZXhwYW5kU3RhdGVSb290OiBib29sZWFuO1xuICBtYXJrU3RhdGVEaWZmOiBib29sZWFuO1xuICBoaWRlTWFpbkJ1dHRvbnM/OiBib29sZWFuO1xufVxuXG5jbGFzcyBMb2dNb25pdG9yPFMsIEEgZXh0ZW5kcyBBY3Rpb248dW5rbm93bj4+IGV4dGVuZHMgUHVyZUNvbXBvbmVudDxcbiAgTG9nTW9uaXRvclByb3BzPFMsIEE+XG4+IHtcbiAgc3RhdGljIHVwZGF0ZSA9IHJlZHVjZXI7XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBkaXNwYXRjaDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgY29tcHV0ZWRTdGF0ZXM6IFByb3BUeXBlcy5hcnJheSxcbiAgICBhY3Rpb25zQnlJZDogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBzdGFnZWRBY3Rpb25JZHM6IFByb3BUeXBlcy5hcnJheSxcbiAgICBza2lwcGVkQWN0aW9uSWRzOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgbW9uaXRvclN0YXRlOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgaW5pdGlhbFNjcm9sbFRvcDogUHJvcFR5cGVzLm51bWJlcixcbiAgICAgIGNvbnNlY3V0aXZlVG9nZ2xlU3RhcnRJZDogUHJvcFR5cGVzLm51bWJlcixcbiAgICB9KSxcblxuICAgIHByZXNlcnZlU2Nyb2xsVG9wOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBzZWxlY3Q6IFByb3BUeXBlcy5mdW5jLFxuICAgIHRoZW1lOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMub2JqZWN0LCBQcm9wVHlwZXMuc3RyaW5nXSksXG4gICAgZXhwYW5kQWN0aW9uUm9vdDogUHJvcFR5cGVzLmJvb2wsXG4gICAgZXhwYW5kU3RhdGVSb290OiBQcm9wVHlwZXMuYm9vbCxcbiAgICBtYXJrU3RhdGVEaWZmOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBoaWRlTWFpbkJ1dHRvbnM6IFByb3BUeXBlcy5ib29sLFxuICB9O1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHM6IERlZmF1bHRQcm9wczx1bmtub3duPiA9IHtcbiAgICBzZWxlY3Q6IChzdGF0ZTogdW5rbm93bikgPT4gc3RhdGUsXG4gICAgdGhlbWU6ICduaWNpbmFib3gnLFxuICAgIHByZXNlcnZlU2Nyb2xsVG9wOiB0cnVlLFxuICAgIGV4cGFuZEFjdGlvblJvb3Q6IHRydWUsXG4gICAgZXhwYW5kU3RhdGVSb290OiB0cnVlLFxuICAgIG1hcmtTdGF0ZURpZmY6IGZhbHNlLFxuICB9O1xuXG4gIHNjcm9sbERvd24/OiBib29sZWFuO1xuICBub2RlPzogSFRNTERpdkVsZW1lbnQgfCBudWxsO1xuXG4gIHVwZGF0ZVNjcm9sbFRvcCA9IGRlYm91bmNlKCgpID0+IHtcbiAgICBjb25zdCBub2RlID0gdGhpcy5ub2RlO1xuICAgIHRoaXMucHJvcHMuZGlzcGF0Y2godXBkYXRlU2Nyb2xsVG9wKG5vZGUgPyBub2RlLnNjcm9sbFRvcCA6IDApKTtcbiAgfSwgNTAwKTtcblxuICBzY3JvbGwoKSB7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMubm9kZTtcbiAgICBpZiAoIW5vZGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMuc2Nyb2xsRG93bikge1xuICAgICAgY29uc3QgeyBvZmZzZXRIZWlnaHQsIHNjcm9sbEhlaWdodCB9ID0gbm9kZTtcbiAgICAgIG5vZGUuc2Nyb2xsVG9wID0gc2Nyb2xsSGVpZ2h0IC0gb2Zmc2V0SGVpZ2h0O1xuICAgICAgdGhpcy5zY3JvbGxEb3duID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMubm9kZTtcbiAgICBpZiAoIW5vZGUgfHwgIXRoaXMucHJvcHMubW9uaXRvclN0YXRlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucHJvcHMucHJlc2VydmVTY3JvbGxUb3ApIHtcbiAgICAgIG5vZGUuc2Nyb2xsVG9wID0gdGhpcy5wcm9wcy5tb25pdG9yU3RhdGUuaW5pdGlhbFNjcm9sbFRvcDtcbiAgICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy51cGRhdGVTY3JvbGxUb3ApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNjcm9sbERvd24gPSB0cnVlO1xuICAgICAgdGhpcy5zY3JvbGwoKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICBjb25zdCBub2RlID0gdGhpcy5ub2RlO1xuICAgIGlmIChub2RlICYmIHRoaXMucHJvcHMucHJlc2VydmVTY3JvbGxUb3ApIHtcbiAgICAgIG5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy51cGRhdGVTY3JvbGxUb3ApO1xuICAgIH1cbiAgfVxuXG4gIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wczogTG9nTW9uaXRvclByb3BzPFMsIEE+KSB7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMubm9kZTtcbiAgICBpZiAoIW5vZGUpIHtcbiAgICAgIHRoaXMuc2Nyb2xsRG93biA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHRoaXMucHJvcHMuc3RhZ2VkQWN0aW9uSWRzLmxlbmd0aCA8IG5leHRQcm9wcy5zdGFnZWRBY3Rpb25JZHMubGVuZ3RoXG4gICAgKSB7XG4gICAgICBjb25zdCB7IHNjcm9sbFRvcCwgb2Zmc2V0SGVpZ2h0LCBzY3JvbGxIZWlnaHQgfSA9IG5vZGU7XG5cbiAgICAgIHRoaXMuc2Nyb2xsRG93biA9XG4gICAgICAgIE1hdGguYWJzKHNjcm9sbEhlaWdodCAtIChzY3JvbGxUb3AgKyBvZmZzZXRIZWlnaHQpKSA8IDIwO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNjcm9sbERvd24gPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgdGhpcy5zY3JvbGwoKTtcbiAgfVxuXG4gIGhhbmRsZVRvZ2dsZUFjdGlvbiA9IChpZDogbnVtYmVyKSA9PiB7XG4gICAgdGhpcy5wcm9wcy5kaXNwYXRjaCh0b2dnbGVBY3Rpb24oaWQpKTtcbiAgfTtcblxuICBoYW5kbGVUb2dnbGVDb25zZWN1dGl2ZUFjdGlvbiA9IChpZDogbnVtYmVyKSA9PiB7XG4gICAgY29uc3QgeyBtb25pdG9yU3RhdGUsIGFjdGlvbnNCeUlkIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgY29uc2VjdXRpdmVUb2dnbGVTdGFydElkIH0gPSBtb25pdG9yU3RhdGU7XG4gICAgaWYgKGNvbnNlY3V0aXZlVG9nZ2xlU3RhcnRJZCAmJiBhY3Rpb25zQnlJZFtjb25zZWN1dGl2ZVRvZ2dsZVN0YXJ0SWRdKSB7XG4gICAgICBjb25zdCB7IHNraXBwZWRBY3Rpb25JZHMgfSA9IHRoaXMucHJvcHM7XG4gICAgICBjb25zdCBzdGFydCA9IE1hdGgubWluKGNvbnNlY3V0aXZlVG9nZ2xlU3RhcnRJZCwgaWQpO1xuICAgICAgY29uc3QgZW5kID0gTWF0aC5tYXgoY29uc2VjdXRpdmVUb2dnbGVTdGFydElkLCBpZCk7XG4gICAgICBjb25zdCBhY3RpdmUgPSBza2lwcGVkQWN0aW9uSWRzLmluZGV4T2YoY29uc2VjdXRpdmVUb2dnbGVTdGFydElkKSA+IC0xO1xuICAgICAgdGhpcy5wcm9wcy5kaXNwYXRjaChzZXRBY3Rpb25zQWN0aXZlKHN0YXJ0LCBlbmQgKyAxLCBhY3RpdmUpKTtcbiAgICAgIHRoaXMucHJvcHMuZGlzcGF0Y2goc3RhcnRDb25zZWN1dGl2ZVRvZ2dsZShudWxsKSk7XG4gICAgfSBlbHNlIGlmIChpZCA+IDApIHtcbiAgICAgIHRoaXMucHJvcHMuZGlzcGF0Y2goc3RhcnRDb25zZWN1dGl2ZVRvZ2dsZShpZCkpO1xuICAgIH1cbiAgfTtcblxuICBnZXRUaGVtZSgpIHtcbiAgICBjb25zdCB7IHRoZW1lIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmICh0eXBlb2YgdGhlbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gdGhlbWU7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiB0aGVtZXNbdGhlbWVdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgcmV0dXJuIHRoZW1lc1t0aGVtZV07XG4gICAgfVxuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICBjb25zb2xlLndhcm4oXG4gICAgICAnRGV2VG9vbHMgdGhlbWUgJyArIHRoZW1lICsgJyBub3QgZm91bmQsIGRlZmF1bHRpbmcgdG8gbmljaW5hYm94J1xuICAgICk7XG4gICAgcmV0dXJuIHRoZW1lcy5uaWNpbmFib3g7XG4gIH1cblxuICBnZXRSZWY6IFJlYWN0LlJlZkNhbGxiYWNrPEhUTUxEaXZFbGVtZW50PiA9IChub2RlKSA9PiB7XG4gICAgdGhpcy5ub2RlID0gbm9kZTtcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgdGhlbWUgPSB0aGlzLmdldFRoZW1lKCk7XG4gICAgY29uc3QgeyBjb25zZWN1dGl2ZVRvZ2dsZVN0YXJ0SWQgfSA9IHRoaXMucHJvcHMubW9uaXRvclN0YXRlO1xuXG4gICAgY29uc3Qge1xuICAgICAgZGlzcGF0Y2gsXG4gICAgICBhY3Rpb25zQnlJZCxcbiAgICAgIHNraXBwZWRBY3Rpb25JZHMsXG4gICAgICBzdGFnZWRBY3Rpb25JZHMsXG4gICAgICBjb21wdXRlZFN0YXRlcyxcbiAgICAgIGN1cnJlbnRTdGF0ZUluZGV4LFxuICAgICAgc2VsZWN0LFxuICAgICAgZXhwYW5kQWN0aW9uUm9vdCxcbiAgICAgIGV4cGFuZFN0YXRlUm9vdCxcbiAgICAgIG1hcmtTdGF0ZURpZmYsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCBlbnRyeUxpc3RQcm9wcyA9IHtcbiAgICAgIHRoZW1lLFxuICAgICAgYWN0aW9uc0J5SWQsXG4gICAgICBza2lwcGVkQWN0aW9uSWRzLFxuICAgICAgc3RhZ2VkQWN0aW9uSWRzLFxuICAgICAgY29tcHV0ZWRTdGF0ZXMsXG4gICAgICBjdXJyZW50U3RhdGVJbmRleCxcbiAgICAgIGNvbnNlY3V0aXZlVG9nZ2xlU3RhcnRJZCxcbiAgICAgIHNlbGVjdCxcbiAgICAgIGV4cGFuZEFjdGlvblJvb3QsXG4gICAgICBleHBhbmRTdGF0ZVJvb3QsXG4gICAgICBtYXJrU3RhdGVEaWZmLFxuICAgICAgb25BY3Rpb25DbGljazogdGhpcy5oYW5kbGVUb2dnbGVBY3Rpb24sXG4gICAgICBvbkFjdGlvblNoaWZ0Q2xpY2s6IHRoaXMuaGFuZGxlVG9nZ2xlQ29uc2VjdXRpdmVBY3Rpb24sXG4gICAgfTtcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IHN0eWxlPXt7IC4uLnN0eWxlcy5jb250YWluZXIsIGJhY2tncm91bmRDb2xvcjogdGhlbWUuYmFzZTAwIH19PlxuICAgICAgICB7IXRoaXMucHJvcHMuaGlkZU1haW5CdXR0b25zICYmIChcbiAgICAgICAgICA8TG9nTW9uaXRvckJ1dHRvbkJhclxuICAgICAgICAgICAgdGhlbWU9e3RoZW1lfVxuICAgICAgICAgICAgZGlzcGF0Y2g9e2Rpc3BhdGNofVxuICAgICAgICAgICAgaGFzU3RhdGVzPXtjb21wdXRlZFN0YXRlcy5sZW5ndGggPiAxfVxuICAgICAgICAgICAgaGFzU2tpcHBlZEFjdGlvbnM9e3NraXBwZWRBY3Rpb25JZHMubGVuZ3RoID4gMH1cbiAgICAgICAgICAvPlxuICAgICAgICApfVxuICAgICAgICA8ZGl2XG4gICAgICAgICAgc3R5bGU9e1xuICAgICAgICAgICAgdGhpcy5wcm9wcy5oaWRlTWFpbkJ1dHRvbnNcbiAgICAgICAgICAgICAgPyBzdHlsZXMuZWxlbWVudHNcbiAgICAgICAgICAgICAgOiB7IC4uLnN0eWxlcy5lbGVtZW50cywgdG9wOiAzMCB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlZj17dGhpcy5nZXRSZWZ9XG4gICAgICAgID5cbiAgICAgICAgICA8TG9nTW9uaXRvckVudHJ5TGlzdCB7Li4uZW50cnlMaXN0UHJvcHN9IC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCAoTG9nTW9uaXRvciBhcyB1bmtub3duKSBhcyBSZWFjdC5Db21wb25lbnRUeXBlPFxuICBFeHRlcm5hbFByb3BzPHVua25vd24sIEFjdGlvbjx1bmtub3duPj5cbj4gJiB7XG4gIHVwZGF0ZShcbiAgICBtb25pdG9yUHJvcHM6IEV4dGVybmFsUHJvcHM8dW5rbm93biwgQWN0aW9uPHVua25vd24+PixcbiAgICBzdGF0ZTogTG9nTW9uaXRvclN0YXRlIHwgdW5kZWZpbmVkLFxuICAgIGFjdGlvbjogTG9nTW9uaXRvckFjdGlvblxuICApOiBMb2dNb25pdG9yU3RhdGU7XG4gIGRlZmF1bHRQcm9wczogRGVmYXVsdFByb3BzPHVua25vd24+O1xufTtcbiJdfQ==